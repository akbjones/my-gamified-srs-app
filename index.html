<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuestLearn SRS - Full Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .card-inner { transition: transform 0.4s; }
        .progress-bar-transition { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .flag-btn { @apply w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center text-4xl border-2 border-slate-700 hover:border-yellow-400 transition-all active:scale-90 shadow-lg; }
        .topic-btn { @apply p-4 bg-slate-800 rounded-xl border border-slate-700 text-left hover:bg-slate-700 transition active:scale-95 flex justify-between items-center; }
    </style>
</head>
<body class="bg-slate-900 text-white font-sans">

    <div id="app" class="max-w-md mx-auto min-h-screen p-6 relative">
        
        <section id="screen-welcome" class="space-y-6 text-center pt-20">
            <h1 class="text-4xl font-bold text-yellow-400 tracking-tight">QuestLearn</h1>
            <p class="text-slate-400 italic">"Your language journey begins..."</p>
            <input id="input-name" type="text" placeholder="Your Name" class="w-full p-4 rounded-xl bg-slate-800 border border-slate-700 outline-none focus:border-blue-500 text-center">
            <button id="btn-start" class="w-full bg-blue-600 p-4 rounded-xl font-bold hover:bg-blue-500 transition shadow-lg">Start Quest</button>
        </section>

        <section id="screen-languages" class="hidden space-y-8 text-center pt-10">
            <h2 class="text-2xl font-bold">Choose Your Language</h2>
            <div class="flex justify-center gap-6">
                <button onclick="selectLanguage('Spanish', 'ğŸ‡ªğŸ‡¸')" class="flag-btn">ğŸ‡ªğŸ‡¸</button>
                <button onclick="selectLanguage('French', 'ğŸ‡«ğŸ‡·')" class="flag-btn">ğŸ‡«ğŸ‡·</button>
                <button onclick="selectLanguage('German', 'ğŸ‡©ğŸ‡ª')" class="flag-btn">ğŸ‡©ğŸ‡ª</button>
            </div>
            <p class="text-slate-500 text-xs uppercase tracking-widest">Select a realm to study</p>
        </section>

        <section id="screen-menu" class="hidden space-y-4">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 id="display-name" class="text-2xl font-bold italic text-yellow-500"></h2>
                    <p id="display-lang" class="text-blue-400 text-sm font-bold uppercase tracking-tighter"></p>
                </div>
                <button onclick="UI.show('settings')" class="text-2xl p-2 bg-slate-800 rounded-full">âš™ï¸</button>
            </div>
            
            <div class="flex justify-between items-center bg-slate-800 p-4 rounded-2xl shadow-lg border border-slate-700">
                <div class="text-sm text-slate-400 uppercase font-bold tracking-tight">Current Streak: <span id="display-streak" class="text-orange-400 text-lg">0</span></div>
                <div class="text-xl">ğŸ”¥</div>
            </div>
            
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-8 mb-2">Adventure Paths</h3>
            <div class="grid gap-4">
                <button onclick="showTopics('Base Curriculum')" class="p-6 bg-slate-800 rounded-3xl border-b-4 border-green-600 text-left active:translate-y-1 transition-all">
                    <div class="font-bold text-xl text-green-400">Base Curriculum</div>
                    <div class="text-xs text-slate-400">6 Mastery Levels (Beg - Pro)</div>
                </button>
                
                <button onclick="showTopics('Targeted Study')" class="p-6 bg-slate-800 rounded-3xl border-b-4 border-blue-600 text-left active:translate-y-1 transition-all">
                    <div class="font-bold text-xl text-blue-400">Targeted Study</div>
                    <div class="text-xs text-slate-400">Business, Travel, Family</div>
                </button>

                <button onclick="showTopics('Vocabulary Sprints')" class="p-6 bg-slate-800 rounded-3xl border-b-4 border-purple-600 text-left active:translate-y-1 transition-all">
                    <div class="font-bold text-xl text-purple-400">Vocabulary Sprints</div>
                    <div class="text-xs text-slate-400">Situational Phrases</div>
                </button>
            </div>
        </section>

        <section id="screen-topics" class="hidden space-y-4">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="UI.show('menu')" class="bg-slate-800 w-10 h-10 rounded-full flex items-center justify-center text-xl">â†</button>
                <h2 id="topic-title" class="text-xl font-bold">Select Level</h2>
            </div>
            <div id="topic-list" class="grid gap-3">
                </div>
        </section>

        <section id="screen-study" class="hidden space-y-6">
            <div class="flex flex-col space-y-2">
                <div class="flex justify-between text-[10px] font-mono text-slate-500 uppercase">
                    <span id="session-title">Quest</span>
                    <span id="session-count">0 / 0</span>
                </div>
                <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
                    <div id="progress-bar-fill" class="bg-green-500 h-full progress-bar-transition" style="width: 0%"></div>
                </div>
            </div>

            <div id="card-container" class="h-80 w-full bg-slate-800 rounded-3xl flex flex-col items-center justify-center p-8 text-center shadow-2xl border border-slate-700 cursor-pointer active:scale-95 transition-transform">
                <div id="card-front" class="space-y-4">
                    <div id="text-target" class="text-3xl font-bold">...</div>
                    <div class="text-blue-400 text-xs uppercase tracking-tighter animate-pulse">ğŸ”Š Auto-playing Audio</div>
                </div>
                <div id="card-back" class="hidden space-y-4 w-full">
                    <div class="w-full border-t border-slate-700 my-4"></div>
                    <div id="text-english" class="text-2xl text-slate-300 italic">...</div>
                    <div class="text-slate-500 text-xs">ğŸ”Š Click to replay</div>
                </div>
            </div>

            <div id="study-controls" class="hidden grid grid-cols-3 gap-3">
                <button data-grade="again" class="bg-red-900/40 border border-red-500 p-4 rounded-xl text-[10px] font-bold uppercase">Again</button>
                <button data-grade="good" class="bg-blue-900/40 border border-blue-500 p-4 rounded-xl text-[10px] font-bold uppercase">Good</button>
                <button data-grade="easy" class="bg-green-900/40 border border-green-500 p-4 rounded-xl text-[10px] font-bold uppercase">Easy</button>
            </div>
        </section>

        <section id="screen-settings" class="hidden space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-blue-400">Settings</h2>
                <button onclick="UI.renderMenu()" class="bg-slate-800 px-3 py-1 rounded text-sm">Close</button>
            </div>
            <button onclick="UI.show('languages')" class="w-full bg-slate-800 p-4 rounded-xl border border-slate-700 font-bold">Change Language</button>
            <button id="btn-reset-progress" class="w-full bg-red-600/20 text-red-500 border border-red-600 p-4 rounded-xl font-bold">Reset All Data</button>
        </section>
    </div>

    <script>
        /** DATA & CONFIG **/
        const topicMap = {
            "Base Curriculum": ["Beginner", "Beginner-Intermediate", "Intermediate", "Advanced-Intermediate", "Advanced", "Professional"],
            "Targeted Study": ["Business", "Travel", "Family"],
            "Vocabulary Sprints": ["Ordering at a restaurant", "Asking for directions", "Opening a bank account"]
        };

        let state = {
            user: JSON.parse(localStorage.getItem('qs_user')) || { name: "", streak: 0, lastStudy: null, selectedLang: "", langEmoji: "" },
            deck: JSON.parse(localStorage.getItem('qs_deck')) || [
                // Demo Data
                { id: 1, category: 'Base Curriculum', topic: 'Beginner', target: "Hola", english: "Hello", interval: 0, ease: 2.5, due: Date.now() },
                { id: 2, category: 'Targeted Study', topic: 'Travel', target: "DÃ³nde estÃ¡ el hotel?", english: "Where is the hotel?", interval: 0, ease: 2.5, due: Date.now() },
                { id: 3, category: 'Vocabulary Sprints', topic: 'Ordering at a restaurant', target: "La cuenta, por favor", english: "The bill, please", interval: 0, ease: 2.5, due: Date.now() }
            ],
            session: { queue: [], currentIndex: 0, isFlipped: false }
        };

        /** HELPERS **/
        function selectLanguage(lang, emoji) {
            state.user.selectedLang = lang;
            state.user.langEmoji = emoji;
            localStorage.setItem('qs_user', JSON.stringify(state.user));
            UI.renderMenu();
        }

        function showTopics(category) {
            const list = document.getElementById('topic-list');
            document.getElementById('topic-title').innerText = category;
            list.innerHTML = "";

            topicMap[category].forEach(topic => {
                const count = state.deck.filter(c => c.category === category && c.topic === topic && c.due <= Date.now()).length;
                const btn = document.createElement('button');
                btn.className = "topic-btn";
                btn.innerHTML = `
                    <div>
                        <div class="font-bold text-slate-200">${topic}</div>
                        <div class="text-[9px] text-slate-500 uppercase tracking-widest mt-1">Available Quest</div>
                    </div>
                    <span class="bg-slate-900 px-2 py-1 rounded text-[10px] text-blue-400 font-mono">${count} Due</span>
                `;
                btn.onclick = () => startSession(category, topic);
                list.appendChild(btn);
            });
            UI.show('topics');
        }

        function startSession(category, topic) {
            state.session.queue = state.deck.filter(c => c.category === category && c.topic === topic && c.due <= Date.now());
            if (!state.session.queue.length) {
                alert("No cards due in this quest yet!");
                return;
            }
            state.session.currentIndex = 0;
            document.getElementById('session-title').innerText = topic;
            UI.show('study');
            UI.renderCard();
        }

        /** UI CONTROLLER **/
        const UI = {
            show(id) {
                ['welcome', 'languages', 'menu', 'topics', 'study', 'settings'].forEach(s => {
                    const el = document.getElementById(`screen-${s}`);
                    if(el) el.classList.add('hidden');
                });
                document.getElementById(`screen-${id}`).classList.remove('hidden');
            },
            renderMenu() {
                if(!state.user.selectedLang) { this.show('languages'); return; }
                document.getElementById('display-name').innerText = `Helo, ${state.user.name}!`;
                document.getElementById('display-lang').innerText = `${state.user.langEmoji} ${state.user.selectedLang} Realm`;
                document.getElementById('display-streak').innerText = state.user.streak;
                this.show('menu');
            },
            renderCard() {
                const card = state.session.queue[state.session.currentIndex];
                if (!card) {
                    this.completeSession();
                    return;
                }
                state.session.isFlipped = false;
                document.getElementById('text-target').innerText = card.target;
                document.getElementById('text-english').innerText = card.english;
                document.getElementById('card-back').classList.add('hidden');
                document.getElementById('study-controls').classList.add('hidden');
                
                const progress = (state.session.currentIndex / state.session.queue.length) * 100;
                document.getElementById('progress-bar-fill').style.width = `${progress}%`;
                document.getElementById('session-count').innerText = `${state.session.currentIndex + 1}/${state.session.queue.length}`;
            },
            completeSession() {
                const today = new Date().toDateString();
                if (state.user.lastStudy !== today) {
                    state.user.streak++;
                    state.user.lastStudy = today;
                    localStorage.setItem('qs_user', JSON.stringify(state.user));
                }
                alert("Quest Complete! Data Saved.");
                this.renderMenu();
            }
        };

        /** LISTENERS **/
        document.getElementById('btn-start').addEventListener('click', () => {
            const name = document.getElementById('input-name').value.trim();
            if (!name) return;
            state.user.name = name;
            localStorage.setItem('qs_user', JSON.stringify(state.user));
            UI.show('languages');
        });

        document.getElementById('card-container').addEventListener('click', () => {
            if (state.session.isFlipped) return;
            state.session.isFlipped = true;
            document.getElementById('card-back').classList.remove('hidden');
            document.getElementById('study-controls').classList.remove('hidden');
        });

        document.querySelectorAll('#study-controls button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const grade = e.currentTarget.getAttribute('data-grade');
                const card = state.session.queue[state.session.currentIndex];
                
                if (grade === 'again') { card.interval = 0; }
                else if (grade === 'good') { card.interval = Math.max(1, (card.interval || 1) * 2); }
                else { card.interval = Math.max(4, (card.interval || 1) * 4); }
                
                card.due = Date.now() + (card.interval * 86400000);
                localStorage.setItem('qs_deck', JSON.stringify(state.deck));
                
                state.session.currentIndex++;
                UI.renderCard();
            });
        });

        document.getElementById('btn-reset-progress').addEventListener('click', () => {
            if (confirm("Erase all quest data?")) { localStorage.clear(); location.reload(); }
        });

        // Init App
        if (state.user.name) UI.renderMenu();
    </script>
</body>
</html>
