<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card-flip { perspective: 1000px; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col items-center p-4">

    <div class="w-full max-w-md bg-slate-800 rounded-full h-2.5 mb-6">
        <div id="progress-bar-fill" class="bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
    </div>

    <div id="flashcard" class="w-full max-w-md bg-slate-800 rounded-2xl p-8 min-h-[300px] flex flex-col items-center justify-center text-center shadow-2xl border border-slate-700 cursor-pointer mb-6">
        <h2 id="text-target" class="text-3xl font-bold mb-4">Loading Deck...</h2>
        <div id="card-back" class="hidden border-t border-slate-700 pt-4 w-full">
            <p id="text-english" class="text-xl text-slate-300"></p>
        </div>
    </div>

    <div id="study-controls" class="hidden w-full max-w-md grid grid-cols-2 gap-4">
        <button onclick="handleAnswer(false)" class="bg-slate-700 hover:bg-slate-600 p-4 rounded-xl font-bold">Hard (Again)</button>
        <button onclick="handleAnswer(true)" class="bg-blue-600 hover:bg-blue-500 p-4 rounded-xl font-bold">Easy (Next)</button>
    </div>

    <script>
        let state = {
            deck: [],
            currentIndex: 0,
            isFlipped: false
        };

        // 1. Load the deck.json file you just uploaded
        async function init() {
            try {
                const response = await fetch('deck.json');
                state.deck = await response.json();
                renderCard();
            } catch (e) {
                document.getElementById('text-target').innerText = "Error: deck.json not found";
            }
        }

        // 2. Audio Player
        function playSound(filename) {
            if (!filename) return;
            const audio = new Audio(`quest-audio/${filename}`);
            audio.play().catch(err => console.log("Click the card to play audio"));
        }

        // 3. Display Card
        function renderCard() {
            const card = state.deck[state.currentIndex];
            if (!card) {
                document.getElementById('text-target').innerText = "Session Complete!";
                return;
            }

            state.isFlipped = false;
            document.getElementById('text-target').innerText = card.target;
            document.getElementById('text-english').innerText = card.english;
            document.getElementById('card-back').classList.add('hidden');
            document.getElementById('study-controls').classList.add('hidden');
            
            playSound(card.audio);

            const progress = (state.currentIndex / state.deck.length) * 100;
            document.getElementById('progress-bar-fill').style.width = `${progress}%`;
        }

        // 4. Handle Flip/Click
        document.getElementById('flashcard').addEventListener('click', () => {
            if (!state.isFlipped) {
                state.isFlipped = true;
                document.getElementById('card-back').classList.remove('hidden');
                document.getElementById('study-controls').classList.remove('hidden');
            }
        });

        function handleAnswer(isCorrect) {
            state.currentIndex++;
            renderCard();
        }

        init();
    </script>
</body>
</html>